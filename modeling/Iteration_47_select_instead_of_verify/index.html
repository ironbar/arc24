
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ironbar.github.io/arc24/modeling/Iteration_47_select_instead_of_verify/">
      
      
        <link rel="prev" href="../Iteration_46_revisit_small_llms/">
      
      
        <link rel="next" href="../Iteration_48_more_external_data/">
      
      
      <link rel="icon" href="../../res/arc_icon.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Iteration 47. Select instead of verify - arc24</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iteration-47-select-instead-of-verify" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="arc24" class="md-header__button md-logo" aria-label="arc24" data-md-component="logo">
      
  <img src="../../res/arc_icon.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            arc24
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Iteration 47. Select instead of verify
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ironbar/arc24" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../01_Business_Understanding/" class="md-tabs__link">
        
  
    
  
  Business Understanding

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../02_Data_Understanding/" class="md-tabs__link">
        
  
    
  
  Data Understanding

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../03_State_of_the_art/" class="md-tabs__link">
        
  
    
  
  State of the art

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Modeling

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../05_Solution_Summary/" class="md-tabs__link">
        
  
    
  
  Solution Summary

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../utils/00_Challenge_Workflow/" class="md-tabs__link">
          
  
    
  
  Utils

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="arc24" class="md-nav__button md-logo" aria-label="arc24" data-md-component="logo">
      
  <img src="../../res/arc_icon.jpg" alt="logo">

    </a>
    arc24
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ironbar/arc24" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_Business_Understanding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Business Understanding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Data_Understanding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Understanding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_State_of_the_art/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State of the art
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Modeling
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_01_few_shot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 1. Few-shot prompting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_02_learn_to_count/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 2. Learn to count
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_03_fine-tune_on_arc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 3. Fine-tune on ARC tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_04_test_time_fine-tuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 4. Test time fine-tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_05_search_for_smaller_llms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 5. Search for smaller LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_06_ensemble_with_2020_solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 6. Ensemble with 2020 solution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_07_training_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 7. Training data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_08_code_improvements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 8. Code improvements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_09_improve_inference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 9. Improve inference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_10_improve_selection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 10. Improve response selection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_11_pseudo_beam_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 11. Pseudo beam-search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_12_grid_representation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 12. Grid representation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_13_single_task_ttft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 13. Single task test-time fine-tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_14_speedup_training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 14. Speedup training with unsloth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_15_study_data_scaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 15. Study how well this method scales with data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_16_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 16. Plan next steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_17_external_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 17. Revisit external training data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_18_submission_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 18. Train models for submission
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_20_bigger_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 20. Bigger models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_21_more_data_augmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 21. More data augmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_22_learning_inputs_distribution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 22. Learning the inputs distribution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_23_more_external_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 23. More external data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_24_overfit_to_the_train_set/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 24. Overfit to the train set
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_25_decouple_ft_and_ttft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 25. Decouple fine-tuning and test-time fine-tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_26_dawn_of_omni_arc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 26. Dawn of Omni-ARC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_27_fix_data_augmentation_bug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 27. Fix data augmentation bug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_28_optimal_train_duration_and_capacity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 28. Optimal train duration and capacity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_29_qwen25/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 29. Qwen 2.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_30_optimal_number_predictions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 30. Optimal number of predictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_31_train_submission_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 31. Train new submission models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_32_llama_32/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 32. Llama 3.2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_33_back_to_smollm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 33. Back to SmolLM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_34_developing_omni_arc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 34. Developing Omni-ARC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_35_optimize_batch_size/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 35. Optimize batch size
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_36_solving_evaluation_tasks_with_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 36. Solving evaluation tasks with code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_37_optimize_code_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 37. Optimize code generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_38_make_non_instruct_models_great_again/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 38. Make non-instruct models great again
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_39_reduce_vllm_ram_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 39. Reduce VLLM RAM usage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_40_try_coding_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 40. Try coding models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_41_next_steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 41. Next steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_42_improve_omniarc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 42. Improve Omni-ARC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_43_train_a_verifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 43. Train a verifier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_44_learn_to_use_strong_compute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 44. Learn to use Strong Compute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_45_improve_verifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 45. Improve the verifier approach
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_46_revisit_small_llms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 46. Revisit small LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Iteration 47. Select instead of verify
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Iteration 47. Select instead of verify
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      Goal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-select-predictions-script" class="md-nav__link">
    <span class="md-ellipsis">
      Create select predictions script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efficient-prediction-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient prediction selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Efficient prediction selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bradley-terry-model" class="md-nav__link">
    <span class="md-ellipsis">
      Bradley-terry model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successive-halving-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Successive halving algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-links-from-the-search" class="md-nav__link">
    <span class="md-ellipsis">
      Other links from the search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-that-it-can-work-with-empty-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Check that it can work with empty predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-on-different-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Try on different predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-submission" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-verifications" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze verifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-results-with-all-vs-all-comparisons" class="md-nav__link">
    <span class="md-ellipsis">
      First results with all vs all comparisons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improving-the-selection-of-2020-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Improving the selection of 2020 predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efficient-implementation-results" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient implementation results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Efficient implementation results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scale-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Scale runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-models" class="md-nav__link">
    <span class="md-ellipsis">
      Different models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-i-achieve-perfect-accuracy-if-training-on-the-evaluation-set" class="md-nav__link">
    <span class="md-ellipsis">
      Can I achieve perfect accuracy if training on the evaluation set?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-results" class="md-nav__link">
    <span class="md-ellipsis">
      Submission results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Submission results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2020-solution" class="md-nav__link">
    <span class="md-ellipsis">
      2020 solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-system" class="md-nav__link">
    <span class="md-ellipsis">
      Full system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    <span class="md-ellipsis">
      TODO
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_48_more_external_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 48. More External data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_49_smolLM2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 49. SmolLM2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_50_last_trainings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration 50. Last trainings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Iteration_n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iteration n. Iteration_title
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_Solution_Summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solution Summary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/00_Challenge_Workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Challenge workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/markdown_cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Markdown cheatsheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" class="md-nav__link">
    <span class="md-ellipsis">
      Goal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development" class="md-nav__link">
    <span class="md-ellipsis">
      Development
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-select-predictions-script" class="md-nav__link">
    <span class="md-ellipsis">
      Create select predictions script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efficient-prediction-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient prediction selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Efficient prediction selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bradley-terry-model" class="md-nav__link">
    <span class="md-ellipsis">
      Bradley-terry model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successive-halving-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Successive halving algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-links-from-the-search" class="md-nav__link">
    <span class="md-ellipsis">
      Other links from the search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-that-it-can-work-with-empty-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Check that it can work with empty predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-on-different-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Try on different predictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-submission" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze submission
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-verifications" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze verifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-results-with-all-vs-all-comparisons" class="md-nav__link">
    <span class="md-ellipsis">
      First results with all vs all comparisons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improving-the-selection-of-2020-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Improving the selection of 2020 predictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efficient-implementation-results" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient implementation results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Efficient implementation results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scale-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Scale runtime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#different-models" class="md-nav__link">
    <span class="md-ellipsis">
      Different models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-i-achieve-perfect-accuracy-if-training-on-the-evaluation-set" class="md-nav__link">
    <span class="md-ellipsis">
      Can I achieve perfect accuracy if training on the evaluation set?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-results" class="md-nav__link">
    <span class="md-ellipsis">
      Submission results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Submission results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2020-solution" class="md-nav__link">
    <span class="md-ellipsis">
      2020 solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-system" class="md-nav__link">
    <span class="md-ellipsis">
      Full system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    <span class="md-ellipsis">
      TODO
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="iteration-47-select-instead-of-verify">Iteration 47. Select instead of verify</h1>
<p><em>29-10-2024</em></p>
<h2 id="goal">Goal</h2>
<p>Can I improve prediction selection if instead of verifying the correctness I select between pairs of predictions?</p>
<h2 id="motivation">Motivation</h2>
<p>We have seen that verifying the predictions has predictive power and is a method that can improve
over voting in some situations. But it is not improving the leaderboard score.</p>
<p>Maybe the problem is that if many predictions are considered correct by the model, there is no
way to separate them just by verifying. However if we compare those predictions directly and ask
the model to select the best one, in that case it is possible that we could discriminate the predictions.</p>
<h2 id="development">Development</h2>
<h3 id="create-select-predictions-script">Create select predictions script</h3>
<pre><code class="language-bash">export checkpoint_folder=/mnt/hdd0/Kaggle/arc24/models/20241026_improve_verifiers/01_verify-and-select_lora032-Qwen2-0.5B-Instruct_lr5e-5_bs32_16000steps_2gpus_8192msl/checkpoint-16000
python easy_select_and_evaluation.py &quot;${checkpoint_folder}&quot; \
--dataset-path /mnt/hdd0/Kaggle/arc24/data/new_partitions/arc-agi_all_challenges.json \
--predictions-path  /mnt/hdd0/Kaggle/arc24/debug/01_full-fine-tuning-Qwen2-0.5B-Instruct_lr5e-5_8e4steps_2gpus_8192msl_checkpoint-80000_inference_evaluation_x032_just_correct_tasks.json \
--n-rounds 4
</code></pre>
<h3 id="efficient-prediction-selection">Efficient prediction selection</h3>
<p>So far we have seen that selection can achieve better accuracy than verify, but at the cost of a much
longer computation time. We have to improve the efficiency of the selection.</p>
<pre><code>I'm looking for ranking and a match making system. These are the specifications:

- n players
- 1v1 matches, draw is not an option.
- I'm only interested in finding the best and second best player, I'm not interested in the other players ranking
- Skill does not change over time, is frozen. Thus the order of the matches is irrelevant
- The ranking and match making system should be as efficient as possible, I want to run the smallest number possible of matches because running a match is expensive
- The method should be robust, there is randomness in the results of the matches. F.e. a double elimination tournament is not robust enough because a player can lost two matches just by chance
</code></pre>
<p>My idea is to work first with a small subset of tasks, and once I have an implementation that feels good enough evaluate all the tasks.</p>
<h4 id="bradley-terry-model">Bradley-terry model</h4>
<p>I believe Bradley-terry model is the correct way to build a ranking where we have static
players that do not evolve over time. ELO ranking and Trueskill rely on the history of matches, whereas Bradley-terry does a global optimization using all available matches and does not care about the order of the matches.</p>
<p>My only doubt is how fast the algorithm is, but hopefully it should be very fast since
the number of players is not very big.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Bradley%E2%80%93Terry_model">Bradleyâ€“Terry model wikipedia</a></li>
<li><a href="https://arxiv.org/abs/2110.03874">Uncertainty quantification in the Bradley-Terry-Luce model</a></li>
<li><a href="https://www.kaggle.com/code/zaharch/bradley-terry-rating-system-for-kaggle-sim-comps">Bradley-Terry rating system for Kaggle sim comps</a></li>
</ul>
<h4 id="successive-halving-algorithms">Successive halving algorithms</h4>
<p>The idea is that each player plays <code>n</code> matches per round, and only the top half players
pass to the next round. If <code>n</code> is big enough is very likely that the top 2 players will
end up being selected.</p>
<p>This method should be able to find the best players while being much more efficient than doing all vs all comparisons.</p>
<h4 id="other-links-from-the-search">Other links from the search</h4>
<ul>
<li><a href="http://csuh.kaist.ac.kr/Suh_ICML2017.pdf">Active Learning for Top-K Rank Aggregation from Noisy Comparisons</a></li>
<li><a href="https://arxiv.org/abs/1109.3701">Active Ranking using Pairwise Comparisons</a></li>
<li>ChatGPT ideas: <a href="https://chatgpt.com/c/67288a50-9950-8012-9c29-1973ef9ef2a4">1</a>, <a href="https://chatgpt.com/c/672889bc-f750-8012-830d-567819dbfb3b">2</a>, <a href="https://chatgpt.com/c/672872e6-d018-8012-a7f7-f11b2ba7d757">3</a></li>
</ul>
<h4 id="implementation-details">Implementation details</h4>
<pre><code class="language-bash">export checkpoint_folder=/mnt/hdd0/Kaggle/arc24/models/20241026_improve_verifiers/01_verify-and-select_lora032-Qwen2-0.5B-Instruct_lr5e-5_bs32_16000steps_2gpus_8192msl/checkpoint-16000
rm /mnt/hdd0/Kaggle/arc24/debug/*debug*.json; python easy_select_and_evaluation.py &quot;${checkpoint_folder}&quot; \
--dataset-path /mnt/hdd0/Kaggle/arc24/data/new_partitions/arc-agi_all_challenges.json \
--predictions-path  /mnt/hdd0/Kaggle/arc24/debug/01_full-fine-tuning-Qwen2-0.5B-Instruct_lr5e-5_8e4steps_2gpus_8192msl_checkpoint-80000_inference_evaluation_x032_just_correct_tasks.json \
--n-rounds 8

#quick command to just run inference
python select_predictions_with_halving.py --model-path /home/gbarbadillo/data/temp_model --output-path /mnt/hdd0/Kaggle/arc24/debug/01_full-fine-tuning-Qwen2-0.5B-Instruct_lr5e-5_8e4steps_2gpus_8192msl_checkpoint-80000_inference_evaluation_x032_just_correct_tasks_m14a9650f_001rounds_debug10_selection.json --dataset-path /mnt/hdd0/Kaggle/arc24/data/new_partitions/arc-agi_all_challenges.json --predictions-path /mnt/hdd0/Kaggle/arc24/debug/01_full-fine-tuning-Qwen2-0.5B-Instruct_lr5e-5_8e4steps_2gpus_8192msl_checkpoint-80000_inference_evaluation_x032_just_correct_tasks.json --n-rounds 10
</code></pre>
<p>When using the first 10 tasks, the naive approach does 953 comparisons each round with the all vs all setup.</p>
<h3 id="check-that-it-can-work-with-empty-predictions">Check that it can work with empty predictions</h3>
<p>One of the experiments that I want to try is to make a better selection of the 2020 solution. I know
that the 2020 solution scores 26 on the leaderboard, however if I use a single attempt I only score 24.
Maybe using the selection model I can keep scoring 26.</p>
<h3 id="try-on-different-predictions">Try on different predictions</h3>
<pre><code class="language-bash">export checkpoint_folder=/mnt/hdd0/Kaggle/arc24/models/20241026_improve_verifiers/01_verify-and-select_lora032-Qwen2-0.5B-Instruct_lr5e-5_bs32_16000steps_2gpus_8192msl/checkpoint-16000
python easy_select_and_evaluation.py &quot;${checkpoint_folder}&quot; \
--predictions-path  /mnt/hdd0/Kaggle/arc24/debug/01_full-fine-tuning-Qwen2-0.5B-Instruct_lr5e-5_8e4steps_2gpus_8192msl_checkpoint-80000_inference_evaluation_x032_just_correct_tasks.json

python easy_select_and_evaluation.py &quot;${checkpoint_folder}&quot; \
--predictions-path  /mnt/hdd0/Kaggle/arc24/debug/05_LoRA-032-Qwen2-0.5B-Instruct_lr1e-4_4e4steps_2gpus_8192msl_checkpoint-40000_inference_evaluation_x032_just_correct_tasks.json

python easy_select_and_evaluation.py &quot;${checkpoint_folder}&quot; \
--predictions-path  /mnt/hdd0/Kaggle/arc24/debug/05_LoRA-128-Qwen2-0.5B-Instruct_lr5e-5_4e4steps_2gpus_8192msl_checkpoint-40000_inference_evaluation_x032_just_correct_tasks.json
</code></pre>
<h2 id="results">Results</h2>
<h3 id="analyze-submission">Analyze submission</h3>
<p>On this <a href="https://www.kaggle.com/code/ironbar/test-2020-solution-script?scriptVersionId=192932864">notebook</a> the 2020 solution
is used with just 1 attempt (the 2 attempt is empty) and scores 24. With <a href="https://www.kaggle.com/code/ironbar/test-2020-solution-script?scriptVersionId=192884747">2 attempts</a>
it scores 26.</p>
<p>My current submission is using that single attempt 2020 submission that scores 24 and combining it
with the result of voting the predictions generated by the transformer. I could use the model to
better select the predictions from 2020 and from the transformer, or I could combine all the predictions
and select among them. My experience with the verifier model suggests that is better to do the selection
of the submissions before combining the two approaches.</p>
<p>There are 3 strategies to improve the submission:</p>
<ol>
<li>Concatenate all the predictions and select the best 2 predictions for each task</li>
<li>Select the best 2 predictions for the 2020 solution and my model predictions and combine the predictions</li>
<li>Select only best 2 predictions for my model, and combine with the combination of 2020 solution</li>
</ol>
<h3 id="analyze-verifications">Analyze verifications</h3>
<p>I have studied the failed verifications and found that 36% of them fail with ties. If I can use
the select mode instead to fix that I might have a better prediction selection mode.</p>
<h3 id="first-results-with-all-vs-all-comparisons">First results with all vs all comparisons</h3>
<p>I have created a first implementation that does all vs all comparisons for all the predictions from a task.</p>
<table>
<thead>
<tr>
<th>n_rounds</th>
<th>top_1 accuracy</th>
<th>top_2 accuracy</th>
<th>runtime (s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>59.0%</td>
<td>75.4%</td>
<td>895</td>
</tr>
<tr>
<td>2</td>
<td>61.9%</td>
<td>79.5%</td>
<td>1773</td>
</tr>
<tr>
<td>4</td>
<td>69.4%</td>
<td>81.7%</td>
<td>3655</td>
</tr>
<tr>
<td>8</td>
<td>74.3%</td>
<td>79.5%</td>
<td>7226</td>
</tr>
<tr>
<td>16</td>
<td>70.5%</td>
<td>83.6%</td>
<td>14371</td>
</tr>
</tbody>
</table>
<p>These results are very promising because we have improved the top_1 accuracy from ~60% to 74% and
the top_2 accuracy from ~80% to 83%. Thus it seems that doing comparisons between the predictions
is a more accurate method than verifying the predictions.</p>
<p>The drawback is that this implementation is very slow. We are doing all versus all comparisons and
that gives the same compute to the best prediction and to the last. Since we are just interested
in the top_2 predictions I should be able to optimize the runtime by a good margin while preserving
or even improving the accuracy.</p>
<h3 id="improving-the-selection-of-2020-predictions">Improving the selection of 2020 predictions</h3>
<p>Using the evaluation dataset we can estimate if we can use model prediction selection to improve the
selection of the submission predictions.</p>
<table>
<thead>
<tr>
<th>solution</th>
<th>top_2 accuracy</th>
<th>top_1 accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td>icecuber</td>
<td>54.0%</td>
<td>48.5%</td>
</tr>
<tr>
<td>icecuber + model select predictions</td>
<td>54.0%</td>
<td>53.5%</td>
</tr>
<tr>
<td>program search</td>
<td>14.0%</td>
<td>14.0%</td>
</tr>
<tr>
<td>combined submission with preference for program search</td>
<td>56.5%</td>
<td>49.0%</td>
</tr>
<tr>
<td>model select predictions</td>
<td>57.0%</td>
<td>56.5%</td>
</tr>
<tr>
<td>perfect combination</td>
<td>57.0%</td>
<td>57.0%</td>
</tr>
</tbody>
</table>
<p>The table shows that when doing the baseline submission combination we get 49% top_1 accuracy and when
we use the model to select predictions we get 56.5% top_1 accuracy which is an amazing improvement.
This has great potential to improve the LB score.</p>
<h3 id="efficient-implementation-results">Efficient implementation results</h3>
<h4 id="scale-runtime">Scale runtime</h4>
<table>
<thead>
<tr>
<th>n_matches per round</th>
<th>top_1 accuracy</th>
<th>top_2 accuracy</th>
<th>runtime (s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>65.70%</td>
<td>80.60%</td>
<td>873</td>
</tr>
<tr>
<td>32</td>
<td>65.70%</td>
<td>83.20%</td>
<td>1101</td>
</tr>
<tr>
<td>32</td>
<td>69.40%</td>
<td>79.90%</td>
<td>1101</td>
</tr>
<tr>
<td>64</td>
<td>69.80%</td>
<td>82.80%</td>
<td>1658</td>
</tr>
<tr>
<td>128</td>
<td>70.90%</td>
<td>82.10%</td>
<td>3064</td>
</tr>
<tr>
<td>256</td>
<td>73.50%</td>
<td>82.10%</td>
<td>6141</td>
</tr>
<tr>
<td>512</td>
<td>71.30%</td>
<td>81.00%</td>
<td>12175</td>
</tr>
</tbody>
</table>
<p>There is too much uncertainty in the metrics to see a clear trend, but using more compute seems to
lead to more accuracy.</p>
<h4 id="different-models">Different models</h4>
<table>
<thead>
<tr>
<th>model</th>
<th>training tasks</th>
<th>top 1 accuracy</th>
<th>top 2 accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Qwen2-0.5B</td>
<td>2</td>
<td>69.4%</td>
<td>79.9%</td>
</tr>
<tr>
<td>Qwen2.5-0.5B</td>
<td>4</td>
<td>70.9%</td>
<td>82.1%</td>
</tr>
<tr>
<td>NanoLM-0.3B-Instruct-v2</td>
<td>4</td>
<td>54.5%</td>
<td>69.4%</td>
</tr>
</tbody>
</table>
<p>The table shows that we can achieve similar results when training a model to do more tasks. It also
shows that smaller models give worse results.</p>
<h3 id="can-i-achieve-perfect-accuracy-if-training-on-the-evaluation-set">Can I achieve perfect accuracy if training on the evaluation set?</h3>
<p>I have used the model <code>/mnt/hdd0/Kaggle/arc24/models/20241026_improve_verifiers/04_cheat-with-evaluation-no-task-augmentation_lora032-Qwen2-0.5B-Instruct_lr5e-5_bs32_16000steps_2gpus_8192msl/checkpoint-16000</code> from the previous iteration and with <code>max_matches_per_round=32</code> it achieves top_1 accuracy of 84.3% and top_2 accuracy of 94.8%. When using
a verifier this numbers were 75% and 93.30% so there is a clear improvement here.</p>
<p>If I use the model <code>/mnt/hdd0/Kaggle/arc24/models/20241028_submission_models/01_lora96-Qwen2.5-0.5B-Instruct_lr1e-4_bs32_100000steps_2gpus_8192msl/checkpoint-100000</code> the accuracy is even higher: 90.7% and 96.3%.
So maybe that is the model that we should be using for submission. This model was also trained to predict
the outputs and the inputs for the ARC tasks. So Omni-ARC approach seems to be working.</p>
<h3 id="submission-results">Submission results</h3>
<p>I have created a new <a href="https://www.kaggle.com/code/ironbar/2020-solution-script-prediction-selection?scriptVersionId=205391943">notebook</a> to see if
I can improve the selection of 2020 solution predictions.</p>
<h4 id="2020-solution">2020 solution</h4>
<p>First attempts get scores of 20 and 21.5, which implies a top_1 accuracy of 76% and 82% respectively.
This is better than the accuracy on the evaluation set.</p>
<p>The drawback is that is not as a good as the <a href="#improving-the-selection-of-2020-predictions">proof of concept of the 2020 solution on the evaluation data</a>, which achieved an impressing 99% top_1 accuracy.</p>
<p>Maybe is better to do just use the previous 2020 prediction selection which scored 24.</p>
<h4 id="full-system">Full system</h4>
<p>I have made two submissions that use the model to select the predictions of the test-time fine-tuning model.</p>
<table>
<thead>
<tr>
<th>selection method</th>
<th>LB score</th>
</tr>
</thead>
<tbody>
<tr>
<td>voting</td>
<td>37, 38, 38</td>
</tr>
<tr>
<td>model</td>
<td>34, 34</td>
</tr>
</tbody>
</table>
<p>The results are clear, voting get's higher accuracy than the selection model.</p>
<p>This contradicts my results on the evaluation dataset. Maybe the predictions generated by a test-time
fine-tuned model are more favorable for voting than the predictions of a frozen model.</p>
<h2 id="conclusion">Conclusion</h2>
<table>
<thead>
<tr>
<th>method</th>
<th>top 1 accuracy</th>
<th>top 2 accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td>voting</td>
<td>60.0%</td>
<td>70.0%</td>
</tr>
<tr>
<td>verification</td>
<td>59.3%</td>
<td>77.4%</td>
</tr>
<tr>
<td>selection</td>
<td><strong>68.7%</strong></td>
<td><strong>81.0%</strong></td>
</tr>
</tbody>
</table>
<p>Using a model to select predictions is the more accurate method of all. It improves an absolute 10%
on top_1 and top_2 over voting.</p>
<p>We implemented an efficient selection algorithm that uses successive halving to focus on the most
promising selections, and the Bradley-Terry ranking system to sort the predictions.</p>
<p>However submission results do not show improvements over voting. My hypothesis is that the predictions
of the test-time fine-tuned model follow a different distribution than the frozen model. And that
different distribution could improve the accuracy of the voting algorithm.</p>
<h2 id="next-steps">Next steps</h2>
<ul>
<li>Test time fine-tuning could be use to train a verifier, if wrong predictions are created for the
  the test data. However I don't believe I have enough compute to do that. If the small LLMs would have worked that would
  have been a real option.</li>
</ul>
<h2 id="todo">TODO</h2>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox" disabled checked/> I need more information to understand the failures of verifying. I need to save the results of the verifications for
  deeper analysis.</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Create a first script to do prediction selection with comparisons. First do an all vs all comparison.</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Update the script to be more efficient and do more selective comparisons, using maybe trueskill.</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> How does the efficient method scales with more compute? (even when it is not feasible, just to know).</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Try the models trained on the previous iteration 46.</li>
<li class="task-list-item"><input type="checkbox" disabled checked/> Submission results</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2024-11-07
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/guillermobarbadillo/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/guille_bar" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCOHmUwHnd2hmUpiDzaQ1Isg" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.kaggle.com/ironbar" target="_blank" rel="noopener" title="www.kaggle.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="../../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>